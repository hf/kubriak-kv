#!/bin/bash

CONFIG=/etc/riak/riak.conf

if [ -z "$RIAK_NODE_NAME" ]
then
  RIAK_NODE_NAME=riak
fi

if [ -z "$RIAK_DISTRIBUTED_COOKIE" ]
then
  RIAK_DISTRIBUTED_COOKIE=riak
fi

LOCAL_HOSTNAME_FQDN=`hostname -f`
LOCAL_HOSTNAME_IP=`hostname -I | awk '{ print $1; }'`

if [ echo "$LOCAL_HOSTNAME_FQDN" | grep -iq '\.' ]
then
  RIAK_NODE_HOSTNAME="$LOCAL_HOSTNAME_FQDN"
else
  RIAK_NODE_HOSTNAME="$LOCAL_HOSTNAME_IP"
fi

echo "# Autogenerated configuration from '/etc/riak/prestart.d/00-autoconfig.sh' via '$0'" >> $CONFIG
echo "nodename = $RIAK_NODE_NAME@$RIAK_NODE_HOSTNAME" >> $CONFIG
echo "distributed_cookie = $RIAK_DISTRIBUTED_COOKIE" >> $CONFIG
echo "listener.protobuf.internal = 0.0.0.0:8087" >> $CONFIG
echo "listener.http.internal = 0.0.0.0:8098" >> $CONFIG

